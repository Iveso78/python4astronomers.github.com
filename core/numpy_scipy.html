<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>A Crash Course in Scientific Python: 2D STIS Reduction &mdash; Python4Astronomers 2.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="top" title="Python4Astronomers 2.0 documentation" href="../index.html" />
    <link rel="up" title="Core packages for analysis: IPython, NumPy, and SciPy" href="core.html" />
    <link rel="next" title="CONTEST: Make a fun bouncing balls demo" href="../contest/bounce.html" />
    <link rel="prev" title="IPython" href="ipython.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="../_static/copybutton.js"></script>

<script type="text/javascript"> 
$(document).ready(function(){

$(".flip0").click(function(){
    $(".panel0").slideToggle("normal");
  });

$(".flip1").click(function(){
    $(".panel1").slideToggle("normal");
  });

$(".flip2").click(function(){
    $(".panel2").slideToggle("normal");
  });

$(".flip3").click(function(){
    $(".panel3").slideToggle("normal");
  });

$(".flip4").click(function(){
    $(".panel4").slideToggle("normal");
  });

$(".flip5").click(function(){
    $(".panel5").slideToggle("normal");
  });

$(".flip6").click(function(){
    $(".panel6").slideToggle("normal");
  });

$(".flip7").click(function(){
    $(".panel7").slideToggle("normal");
  });

$(".flip8").click(function(){
    $(".panel8").slideToggle("normal");
  });

$(".flip9").click(function(){
    $(".panel9").slideToggle("normal");
  });

});
</script>
 
<style type="text/css"> 

div.panel0,p.flip0
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip0
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel0
{
display:none;
}

div.panel1,p.flip1
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip1
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel1
{
display:none;
}

div.panel2,p.flip2
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip2
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel2
{
display:none;
}

div.panel3,p.flip3
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip3
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel3
{
display:none;
}

div.panel4,p.flip4
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip4
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel4
{
display:none;
}

div.panel5,p.flip5
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip5
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel5
{
display:none;
}

div.panel6,p.flip6
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip6
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel6
{
display:none;
}

div.panel7,p.flip7
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip7
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel7
{
display:none;
}

div.panel8,p.flip8
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip8
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel8
{
display:none;
}

div.panel9,p.flip9
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip9
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel9
{
display:none;
}

</style>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18709417-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


  </head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">python</span><span id="logotext2">4</span><span id="logotext3">astronomers</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../contest/bounce.html" title="CONTEST: Make a fun bouncing balls demo">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="ipython.html" title="IPython">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">Python4Astronomers 2.0 documentation</a>
	 &raquo;
      </li>
      <li><a href="core.html" accesskey="U">Core packages for analysis: IPython, NumPy, and SciPy</a> &raquo;</li>
      
      <li>A Crash Course in Scientific Python: 2D STIS Reduction</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="a-crash-course-in-scientific-python-2d-stis-reduction">
<h1>A Crash Course in Scientific Python: 2D STIS Reduction<a class="headerlink" href="#a-crash-course-in-scientific-python-2d-stis-reduction" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial we’ll learn some bread-and-butter scientific Python skills by
performing a very simple reduction of a 2-dimensional long slit spectrum. The
data are HST/STIS observations of the Seyfert galaxy <a class="reference external" href="http://simbad.u-strasbg.fr/simbad/sim-id?protocol=html&amp;Ident=3c%20120&amp;NbIdent=1&amp;Radius=2&amp;Radius.unit=arcmin">3C 120</a>.
We’ll perform the following steps:</p>
<ul class="simple">
<li>Read in the 2D image.</li>
<li>Plot the spatial profile and raw spectrum.</li>
<li>Filter cosmic rays from the background.</li>
<li>Fit for the background and subtract.</li>
<li>Sum the source signal.</li>
</ul>
<p>If you’re not a STIS user or spectroscopist, don’t worry: you don’t need to
know anything about these to do the tutorial.</p>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>2-d longslit image</strong></th>
<th class="head"><strong>Final 1-d spectrum</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="first last reference internal image-reference" href="../_images/3c120.png"><img alt="../_images/3c120.png" src="../_images/3c120.png" style="width: 378.0px; height: 290.5px;" /></a>
</td>
<td><a class="first last reference internal image-reference" href="../_images/3c120_spec.gif"><img alt="../_images/3c120_spec.gif" src="../_images/3c120_spec.gif" style="width: 382.5px; height: 306.0px;" /></a>
</td>
</tr>
</tbody>
</table>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>We assume that you have already installed Python, <a class="reference external" href="https://ipython.org/">IPython</a>, and <a class="reference external" href="http://www.astropy.org/">AstroPy</a>. <strong>If this
is not the case, talk to the person(s) running your workshop.</strong></p>
<p>Next, open up a terminal and <code class="docutils literal"><span class="pre">cd</span></code> to a directory where we can put some
temporary files. Now start up IPython, the enhanced Python user interface
(“shell”), by running the following command in your terminal:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ipython</span> <span class="o">--</span><span class="n">matplotlib</span>
</pre></div>
</div>
<p>Next we’re going to download some data files that this tutorial needs. Python
comes with enough built-in features that we can actually to this from within
IPython. Type the following lines in your IPython shell, making sure to type
in everything exactly as shown and hitting <code class="docutils literal"><span class="pre">Enter</span></code> after each line:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>from astropy.extern.six.moves.urllib import request
import tarfile
url = &#39;http://python4astronomers.github.io/_downloads/core_examples.tar&#39;
tarfile.open(fileobj=request.urlopen(url), mode=&#39;r|&#39;).extractall()
%ls py4ast/core
</pre></div>
</div>
<p>The first four commands should not print anything. The last command is like an
<code class="docutils literal"><span class="pre">ls</span></code> in a regular terminal and should show that you have a file named
<code class="docutils literal"><span class="pre">3c120_stis.fits.gz</span></code>. <strong>If anything surprising happens here, immediately
flag down an instructor and ask them to check your setup.</strong></p>
<p>(There’s nothing stopping you from using copy/paste to get these commands into
your IPython window, but we recommand that you type them manually to start
developing your “finger memory” for typing Python.)</p>
</div>
<div class="section" id="warming-up-your-ipython-session">
<h2>Warming up your IPython session<a class="headerlink" href="#warming-up-your-ipython-session" title="Permalink to this headline">¶</a></h2>
<p>Because Python is a general-purpose language, we need to explicitly load in
the modules that are useful for astronomy. We’ll start with two.</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://www.numpy.org/">NumPy</a> is at the core of nearly every scientific
Python application or module. It lets you create variables that represent
multi-dimensional arrays and do fast, vectorized math on them. This will
be familiar to users of IDL or Matlab.</li>
<li><a class="reference external" href="http://matplotlib.org/">Matplotlib</a> is the most popular module for
making plots in Python. Its design is modeled off of Matlab’s plotting
commands.</li>
</ul>
</div></blockquote>
<p>We load these up by typing:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<p>As above, type these command exactly as written and hit <code class="docutils literal"><span class="pre">Enter</span></code> at the end
of each line. Throughout the rest of this tutorial, when you see Python code
displayed as above, do the same unless instructed otherwise.</p>
<p>If you need to exit and restart IPython, you will need to rerun these
<code class="docutils literal"><span class="pre">import</span></code> commands before you can do anything. (It forgets everything you did
when you exit it.) You do <em>not</em> need to rerun the <code class="docutils literal"><span class="pre">tarfile</span></code> commands in the
previous section, since those are only needed to download a couple of files
that will stick around on your hard drive.</p>
<p>NumPy has a good and systematic <a class="reference external" href="http://www.scipy.org/Tentative_NumPy_Tutorial">basic tutorial</a> available. We recommend that
you read this tutorial to fill in the gaps left by this workshop, but on its
own it’s a bit dry for the impatient astronomer.</p>
</div>
<div class="section" id="read-in-the-two-dimensional-image">
<h2>Read in the two-dimensional image<a class="headerlink" href="#read-in-the-two-dimensional-image" title="Permalink to this headline">¶</a></h2>
<p>Let’s get started with the science! First we’ll read in the long-slit spectrum
data. The standard file format available for download from <a class="reference external" href="http://archive.stsci.edu/hst/">MAST</a> is a FITS-format file. It contains three
identically-sized images providing the 2D spectral intensity, error values,
and data quality for each pixel. Open up the FITS file with these commands:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="n">hdus</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;py4ast/core/3c120_stis.fits.gz&#39;</span><span class="p">)</span>
<span class="n">hdus</span>
</pre></div>
</div>
<p>The second command creates a variable named <code class="docutils literal"><span class="pre">hdus</span></code> that represents the
opened FITS file, and the third command prints out some diagnostic information
about it.</p>
<p>In IPython, if you just type in a variable’s name as a command, you are shown
its value. If you type a variable’s name with a question mark, you’re shown
more details. Like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>hdus?
</pre></div>
</div>
<p>You may not be used to understanding the output from these diagnostic
commands, but they’re telling you that the <code class="docutils literal"><span class="pre">hdus</span></code> variable acts like a list
of values, one for each “Header Data Unit” in the FITS file. Let’s give
meaningful names to each of the three images that are available in this FITS
file. As in many other languages, in Python you can access the <em>n</em>-th element
of a list by “indexing” it: suffixing its name with brackets, something like
<code class="docutils literal"><span class="pre">hdus[n]</span></code>. Also as in many other languages, index numbers start at zero
rather than one. So we write:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">primary</span> <span class="o">=</span> <span class="n">hdus</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># Primary (NULL) header data unit</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">hdus</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>      <span class="c1"># Intensity data</span>
<span class="n">err</span> <span class="o">=</span> <span class="n">hdus</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>      <span class="c1"># Error per pixel</span>
<span class="n">dq</span> <span class="o">=</span> <span class="n">hdus</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>       <span class="c1"># Data quality per pixel</span>
</pre></div>
</div>
<p>Here we also show how to make a comment in Python: anything between a hash
sign (<code class="docutils literal"><span class="pre">#</span></code>) and the end of a line is ignored.</p>
<p>Next have a look at the images using one of the standard Matplotlib plotting
functions. The slit (spatial) direction is along the rows (up and down) and
wavelength is in columns (left to right).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
<p>You should see something resembling a horizontal line, but it will be
difficult to make out much with the default settings. So, let’s set a few
options for this plot. It’s not obvious from the data alone, but we want the
origin in the lower left instead of the upper left corner. We also want to
change the color scaling to something more sensible. By default,
<code class="docutils literal"><span class="pre">plt.imshow()</span></code> scales the colors from the minimum to the maximum value in
the data array that we pass it. In our case that is not the best option. We
can set a lower and upper bound and add a colorbar to our plot:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">65</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
<p>Your plot should now look like something like what we show below. The colors
may vary depending on your system’s settings.</p>
<a class="reference internal image-reference" href="../_images/imgview_img.png"><img alt="../_images/imgview_img.png" src="../_images/imgview_img.png" style="width: 406.0px; height: 306.0px;" /></a>
<div class="admonition-exercise-view-the-error-and-data-quality-images admonition">
<p class="first admonition-title">Exercise: View the error and data quality images</p>
<p class="last">Bring up a viewer window for the other two images. Play with various buttons
on the toolbar buttons and try to determine their functions. (Hint: imagine
a web browser for the three on the left). Does the save button work for you?</p>
</div>
<p class="flip1">Click here to show/hide solution</p> <div class="panel1"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Errors</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="c1"># Data quality</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/imgview_err.png"><img alt="../_images/imgview_err.png" src="../_images/imgview_err.png" style="width: 406.0px; height: 306.0px;" /></a>
<a class="reference internal image-reference" href="../_images/imgview_dq.png"><img alt="../_images/imgview_dq.png" src="../_images/imgview_dq.png" style="width: 406.0px; height: 306.0px;" /></a>
</div><div class="section" id="digging-deeper-in-the-2d-image">
<h3>Digging deeper in the 2D image<a class="headerlink" href="#digging-deeper-in-the-2d-image" title="Permalink to this headline">¶</a></h3>
<p>Now discover a little bit about the images you have read in, first with <code class="docutils literal"><span class="pre">?</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>img?
</pre></div>
</div>
<p>If you get stuck with a colon (<code class="docutils literal"><span class="pre">:</span></code>) at the bottom of the screen without
getting your prompt back, hit the <code class="docutils literal"><span class="pre">q</span></code> key. There is also a <code class="docutils literal"><span class="pre">help</span></code> function
that gives you slightly different information:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
<p>The same goes here: hit <code class="docutils literal"><span class="pre">q</span></code> to exit out of the display if you don’t get your
prompt back. (This is called the “pager” and it follows the keys of the Unix
<code class="docutils literal"><span class="pre">more</span></code> command.)</p>
<p>Finally, it is very important to get used to using “tab completion” to learn
what you can do with your variables. At your IPython terminal, type <code class="docutils literal"><span class="pre">img.</span></code>
<em>without hitting Enter*</em>, then hit the <code class="docutils literal"><span class="pre">Tab</span></code> key. You should see a table of
names representing functions on the <code class="docutils literal"><span class="pre">img</span></code> variable. You can keep hitting
<code class="docutils literal"><span class="pre">Tab</span></code> to cycle through the options, or use an arrow key to make the display
go away. IPython is very smart and will give you helpful tab-completion
suggestions for partial variable names, module names, functions, and more.</p>
<p>Finally let’s find the shape of the image and its minimum value:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">img</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># Print the shape of img</span>
<span class="n">img</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>  <span class="c1"># Call the min() method on the img object.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="numpy-basics">
<h2>NumPy basics<a class="headerlink" href="#numpy-basics" title="Permalink to this headline">¶</a></h2>
<p>Before going further in our data analysis, we need to learn about a few key
features of NumPy.</p>
<div class="section" id="making-arrays">
<h3>Making arrays<a class="headerlink" href="#making-arrays" title="Permalink to this headline">¶</a></h3>
<p>Recall that we said that the key feature of NumPy is that it lets us create
variables containing multi-dimensional arrays of numbers. You can create these
arrays in numerous ways. Below we show some examples. Here, the <code class="docutils literal"><span class="pre">&gt;&gt;&gt;</span></code> prefix
indicates a line that you could type into IPython, and any following lines
without that prefix show what IPython will show you in response. You don’t
have to type in these examples, but make sure to read them carefully.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">])</span> <span class="c1"># create an array from a list of values</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([10, 20, 30, 40]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># create an array of 4 integers, from 0 to 3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">array([0, 1, 2, 3])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># create an array from 0 to 100 stepping by 0.1</span>
<span class="go">array([ 0. ,  0.1,  0.2,  0.3,  0.4,  0.5,  0.6,  0.7,  0.8,  0.9,  1. ,</span>
<span class="go">        1.1,  1.2,  1.3,  1.4,  1.5,  1.6,  1.7,  1.8,  1.9,  2. ,  2.1,</span>
<span class="go">        2.2,  2.3,  2.4,  2.5,  2.6,  2.7,  2.8,  2.9,  3. ,  3.1,  3.2,</span>
<span class="go">        3.3,  3.4,  3.5,  3.6,  3.7,  3.8,  3.9,  4. ,  4.1,  4.2,  4.3,</span>
<span class="go">        4.4,  4.5,  4.6,  4.7,  4.8,  4.9,  5. ,  5.1,  5.2,  5.3,  5.4,</span>
<span class="go">        5.5,  5.6,  5.7,  5.8,  5.9,  6. ,  6.1,  6.2,  6.3,  6.4,  6.5,</span>
<span class="go">        6.6,  6.7,  6.8,  6.9,  7. ,  7.1,  7.2,  7.3,  7.4,  7.5,  7.6,</span>
<span class="go">        7.7,  7.8,  7.9,  8. ,  8.1,  8.2,  8.3,  8.4,  8.5,  8.6,  8.7,</span>
<span class="go">        8.8,  8.9,  9. ,  9.1,  9.2,  9.3,  9.4,  9.5,  9.6,  9.7,  9.8,</span>
<span class="go">        9.9])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># create an array of 5 evenly spaced samples from -pi to pi</span>
<span class="go">array([-3.14159265, -1.57079633,  0.        ,  1.57079633,  3.14159265]))</span>
</pre></div>
</div>
<p>New arrays can be obtained by operating with existing arrays. In NumPy, when
you do math with arrays, it will do the math “elementwise,” by performing the
requested operation on each array element separately. Continuing the above
examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># elementwise operations</span>
<span class="go">array([10, 21, 34, 49])</span>
</pre></div>
</div>
<p>Arrays may have more than one dimension:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  <span class="c1"># 3 x 4 array of ones</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span>
<span class="go">array([[ 1.,  1.,  1.,  1.],</span>
<span class="go">       [ 1.,  1.,  1.,  1.],</span>
<span class="go">       [ 1.,  1.,  1.,  1.]])</span>
</pre></div>
</div>
<p>Every element in an array must have the same “type”, but different arrays can
be filled with different types. As is very common in computing, Python and
NumPy distinguish between integer and “float” values. Integers (or just
“ints”) can only take on integral values (fair enough), while ”floats” can
approximate almost any real number. (“Float” is short for “floating-point,”
which refers to the broad scheme by which non-integral values are encoded in
binary. It is far beyond the purview of this tutorial, but every would-be
scientific programmer <em>must</em> learn the basics of floating-point arithmetic.)
In NumPy, each array has a “data type,” or <code class="docutils literal"><span class="pre">dtype</span></code> for short, that specifies
the type of its contents:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># 2 x 3 x 4 integer array of zeros</span>
<span class="go">array([[[0, 0, 0, 0],</span>
<span class="go">        [0, 0, 0, 0],</span>
<span class="go">        [0, 0, 0, 0]],</span>
<span class="go">       [[0, 0, 0, 0],</span>
<span class="go">        [0, 0, 0, 0],</span>
<span class="go">        [0, 0, 0, 0]]])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  <span class="c1"># array of zeros with same shape and type as &quot;f&quot;</span>
<span class="go">array([[ 0.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  0.,  0.,  0.],</span>
<span class="go">       [ 0.,  0.,  0.,  0.]]))</span>
</pre></div>
</div>
<p>You can change the dimensions of existing arrays, including changing the
number of dimensions that they have:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>  <span class="c1"># does not modify the total number of elements</span>
<span class="go">array([[ 0,  1,  2,  3],</span>
<span class="go">       [ 4,  5,  6,  7],</span>
<span class="go">       [ 8,  9, 10, 11]])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">array([0, 1, 2, 3, 4])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Same thing but NumPy figures out correct length</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<span class="go">array([[0],</span>
<span class="go">       [1],</span>
<span class="go">       [2],</span>
<span class="go">       [3],</span>
<span class="go">       [4]]))</span>
</pre></div>
</div>
<p>It is possible to operate with arrays of different dimensions as long as they
fit “well”. NumPy does this using a paradigm called <a class="reference external" href="http://docs.scipy.org/doc/numpy/user/basics.broadcasting.html">broadcasting</a>. In short,
NumPy will almost always “do what you want” without needing any tricks. But
frequent NumPy users should read the rules of broadcasting to make sure they
understand how the system works.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(5,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(5, 1)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="mi">10</span>
<span class="go">array([[ 0,  1,  2,  3,  4],</span>
<span class="go">       [10, 11, 12, 13, 14],</span>
<span class="go">       [20, 21, 22, 23, 24],</span>
<span class="go">       [30, 31, 32, 33, 34],</span>
<span class="go">       [40, 41, 42, 43, 44]])</span>
</pre></div>
</div>
<div class="admonition-exercise-make-a-ripple admonition">
<p class="first admonition-title">Exercise: Make a ripple</p>
<p class="last">Set <code class="docutils literal"><span class="pre">x</span></code> to an array that goes from -20 to 20, stepping by 0.25. Make <code class="docutils literal"><span class="pre">y</span></code>
the same as <code class="docutils literal"><span class="pre">x</span></code> but &#8220;transposed&#8221; using the <code class="docutils literal"><span class="pre">reshape</span></code> trick above.
Calculate a surface <code class="docutils literal"><span class="pre">z</span> <span class="pre">=</span> <span class="pre">cos(r)</span> <span class="pre">/</span> <span class="pre">(r</span> <span class="pre">+</span> <span class="pre">5)</span></code> where <code class="docutils literal"><span class="pre">r</span> <span class="pre">=</span> <span class="pre">sqrt(x**2</span> <span class="pre">+</span>
<span class="pre">y**2)</span></code>. Use <cite>plt.imshow</cite> to display the image of <code class="docutils literal"><span class="pre">z</span></code>.</p>
</div>
<p class="flip3">Click here to show/hide solution</p> <div class="panel3"><div class="highlight-python"><div class="highlight"><pre><span></span>x = np.arange(-20, 20, 0.25)
y = x.reshape(-1, 1)
r = np.sqrt(x**2 + y**2)
z = np.cos(r) / (r + 5)
plt.imshow(z, origin = &#39;lower)
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/ripple.png"><img alt="../_images/ripple.png" src="../_images/ripple.png" style="width: 406.0px; height: 306.0px;" /></a>
</div></div>
<div class="section" id="array-access-and-slicing">
<h3>Array access and slicing<a class="headerlink" href="#array-access-and-slicing" title="Permalink to this headline">¶</a></h3>
<p>NumPy provides powerful methods for accessing array elements or particular
subsets of an array, e.g. “the fourth column” or “every other row.” This is
called “slicing.” The outputs below illustrate basic slicing. Once again you
don&#8217;t need to type these examples, but you should read them carefully:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[ 0,  1,  2,  3,  4],</span>
<span class="go">      [ 5,  6,  7,  8,  9],</span>
<span class="go">      [10, 11, 12, 13, 14],</span>
<span class="go">      [15, 16, 17, 18, 19]])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>  <span class="c1"># select element in row 2, column 3 (counting from 0)</span>
<span class="go">13</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># select every element in row 2</span>
<span class="go">array([10, 11, 12, 13, 14])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># select every element in column 0</span>
<span class="go">array([ 0,  5, 10, 15])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># select columns 0 to *3* in row 2</span>
<span class="go">array([10, 11, 12, 13])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># select a sub-matrix.</span>
<span class="go">array([[ 1,  2],</span>
<span class="go">       [ 6,  7],</span>
<span class="go">       [11, 12]])</span>
</pre></div>
</div>
<p>As a first practical example, let’s plot column 300 of the STIS long-slit
image to look at the spatial profile:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>  <span class="c1"># Start a new plot -- by default matplotlib overplots.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">img</span><span class="p">[:,</span> <span class="mi">300</span><span class="p">])</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/img_col300.png"><img alt="../_images/img_col300.png" src="../_images/img_col300.png" style="width: 406.0px; height: 306.0px;" /></a>
<p>The formal syntax for array slicing is as follows. For each dimension of an
array, the most general “slice” that you can write has the form:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>I0:I1:STEP
</pre></div>
</div>
<p>Where</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">I0</span></code> is the first index value. This can be any Python expression that
works out to an integer, or you can leave it blank to default to <code class="docutils literal"><span class="pre">0</span></code>.</li>
<li><code class="docutils literal"><span class="pre">I1</span></code> is the index upper bound. Once again this can be any Python
expression. If you leave it blank, the slicing goes until the end of the
axis.</li>
<li><code class="docutils literal"><span class="pre">STEP</span></code> is the “step size” between each successive index. The default is
one. When <code class="docutils literal"><span class="pre">step</span></code> is not specified then the final <code class="docutils literal"><span class="pre">:</span></code> is not required.</li>
</ul>
<p>The number one “gotcha” about slicing is that the <code class="docutils literal"><span class="pre">I1</span></code>-th index is <strong>not</strong>
included in your slice. For instance, the slice <code class="docutils literal"><span class="pre">1:3</span></code> selects only two
elements. The slice <code class="docutils literal"><span class="pre">3:3</span></code> selects <em>zero</em> array elements (which is perfectly
allowed). This definition is counterintuitive for most people, but it has its
merits. For instance, the number of elements in a slice is exactly <code class="docutils literal"><span class="pre">I1</span> <span class="pre">-</span> <span class="pre">I0</span></code>
(unless <code class="docutils literal"><span class="pre">STEP</span></code> is not 1). And the slices <code class="docutils literal"><span class="pre">X:Y</span></code> and <code class="docutils literal"><span class="pre">Y:Z</span></code> are
non-overlapping subsets of the slice <code class="docutils literal"><span class="pre">X:Z</span></code>.</p>
<p>To slice an array along multiple dimensions at once, you just separate
different slices with commas, writing something along the lines of:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">[</span><span class="n">SLICE0</span><span class="p">,</span> <span class="n">SLICE1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>Where <code class="docutils literal"><span class="pre">SLICE0</span></code> stands for one of the expressions described above, and so on.</p>
<p>There are other special cases to slicing: negative indices have special
meaning, for instance. <strong>TODO</strong>: point to comprehensive documentation! I can‘t
find any!</p>
<div class="admonition-exercise-slice-the-error-array admonition">
<p class="first admonition-title">Exercise: Slice the error array</p>
<ul class="last simple">
<li>Starting with column 10 and ending at column 200, plot every third column
of row 254 of the error array <code class="docutils literal"><span class="pre">err</span></code>.</li>
<li>Print out the numbers in a rectangular sub-matrix of the data quality
array <code class="docutils literal"><span class="pre">dq</span></code> with rows 251 to 253 (inclusive) and columns 101 to 104
(inclusive). What did you learn about the index upper bound value?</li>
</ul>
</div>
<p class="flip2">Click here to show/hide solution</p> <div class="panel2"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">err</span><span class="p">[</span><span class="mi">254</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">200</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
<span class="n">dq</span><span class="p">[</span><span class="mi">251</span><span class="p">:</span><span class="mi">254</span><span class="p">,</span> <span class="mi">101</span><span class="p">:</span><span class="mi">105</span><span class="p">]</span>
</pre></div>
</div>
<p>The index upper bound <code class="docutils literal"><span class="pre">I1</span></code> is one more than the final index that gets
included in the slice. In other words the slice includes everything up to,
<em>but not including</em>, the index upper bound <code class="docutils literal"><span class="pre">I1</span></code>. There are good reasons for
this, but for now just accept and learn it.</p>
<a class="reference internal image-reference" href="../_images/err_row254.png"><img alt="../_images/err_row254.png" src="../_images/err_row254.png" style="width: 406.0px; height: 306.0px;" /></a>
</div></div>
</div>
<div class="section" id="plot-the-spatial-profile-and-raw-spectrum">
<h2>Plot the spatial profile and raw spectrum<a class="headerlink" href="#plot-the-spatial-profile-and-raw-spectrum" title="Permalink to this headline">¶</a></h2>
<p>Plot the spatial profile by summing along the wavelength direction:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">profile</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
</pre></div>
</div>
<p>Now plot the spectrum by summing along the spatial direction:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">spectrum</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>
</pre></div>
</div>
<p>Since most of the sum is in the background region there is a lot of noise and
cosmic-ray contamination.</p>
<a class="reference internal image-reference" href="../_images/profile.png"><img alt="../_images/profile.png" src="../_images/profile.png" style="width: 406.0px; height: 306.0px;" /></a>
<a class="reference internal image-reference" href="../_images/spectrum_noisy.png"><img alt="../_images/spectrum_noisy.png" src="../_images/spectrum_noisy.png" style="width: 406.0px; height: 306.0px;" /></a>
<div class="admonition-exercise-use-slicing-to-make-a-better-spectrum-plot admonition">
<p class="first admonition-title">Exercise: Use slicing to make a better spectrum plot</p>
<p class="last">Use slicing to do the spectrum sum using only the rows in the image where
there is a signal from the source. Hint: zoom into your profile plot to find
a reasonable range of rows to use.</p>
</div>
<p class="flip4">Click here to show/hide solution</p> <div class="panel4"><p>Here’s one suggested row range:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">spectrum</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="mi">250</span><span class="p">:</span><span class="mi">260</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/spectrum_clean.png"><img alt="../_images/spectrum_clean.png" src="../_images/spectrum_clean.png" style="width: 406.0px; height: 306.0px;" /></a>
</div></div>
<div class="section" id="filter-cosmic-rays-from-the-background">
<h2>Filter cosmic rays from the background<a class="headerlink" href="#filter-cosmic-rays-from-the-background" title="Permalink to this headline">¶</a></h2>
<p>Let’s plot five columns from the spectrum image as follows. Recall that each
column is a cut along the spatial direction; so we’re isolating the data from
five adjacent wavelength bins:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">img</span><span class="p">[:,</span> <span class="mi">254</span><span class="p">:</span><span class="mi">259</span><span class="p">])</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/img_row254_noisy.png"><img alt="../_images/img_row254_noisy.png" src="../_images/img_row254_noisy.png" style="width: 406.0px; height: 306.0px;" /></a>
<p>The basic goal of two-dimensional spectral extraction is to subtract out the
background and sum over the rows with the source signal.</p>
<p>The big spikes in the plot you just made are showing that there are
significant cosmic ray defects in the data. In order to do a good job of
subtracting the background we need to filter them out. Doing this correctly in
general is difficult, and for real work we’d just use the answers already
provided by the Hubble data analysts. But let’s pretend that we have to do the
cosmic-ray filtering ourselves.</p>
<p>A simple strategy to accomplish this is to use a median filter to smooth out
single-pixel deviations. Then we can use sigma-clipping to remove large
variations between the actual and smoothed image. We will leverage existing
routines in the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/tutorial/signal.html">SciPy signal processing module</a> to
accomplish this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.signal</span>
<span class="n">img_sm</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">medfilt</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="n">bad</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">img</span> <span class="o">-</span> <span class="n">img_sm</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">8.0</span>
<span class="n">img_cr</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">img_cr</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">img_sm</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span>
<span class="n">img_cr</span><span class="p">[</span><span class="mi">230</span><span class="p">:</span><span class="mi">280</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="mi">230</span><span class="p">:</span><span class="mi">280</span><span class="p">,:]</span>  <span class="c1"># Filter only for background</span>
</pre></div>
</div>
<p>Let’s check if it worked by making the same plot as before, but using the
filtered data</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">img_cr</span><span class="p">[:,</span> <span class="mi">254</span><span class="p">:</span><span class="mi">259</span><span class="p">])</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/img_row254_clean.png"><img alt="../_images/img_row254_clean.png" src="../_images/img_row254_clean.png" style="width: 406.0px; height: 306.0px;" /></a>
<p>Above we used an important NumPy tool: indexing an array with a <strong>boolean
mask</strong>. Let&#8217;s look at a smaller example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neg</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Parentheses here for clarity but are not required</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neg</span>
<span class="go">array([False, False,  True, False,  True], dtype=bool)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="n">neg</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([1, 4, 0, 4, 0])</span>
</pre></div>
</div>
<p>A slightly more complex example shows that this works the same on
multi-dimensional arrays, and that you can compose logical expressions:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ok</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">)</span>  <span class="c1"># &quot;ok = a &gt; 6 &amp; a &lt; 17&quot; will FAIL!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="o">~</span><span class="n">ok</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># &quot;~&quot; is the &quot;logical not&quot; operator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[ 0,  0,  0,  0,  0],</span>
<span class="go">       [ 0,  0,  7,  8,  9],</span>
<span class="go">       [10, 11, 12, 13, 14],</span>
<span class="go">       [15, 16,  0,  0,  0],</span>
<span class="go">       [ 0,  0,  0,  0,  0]])</span>
</pre></div>
</div>
<div class="admonition-exercise-intermediate-circular-region-slicing admonition">
<p class="first admonition-title">Exercise [intermediate]: circular region slicing</p>
<p class="last">Remember the surface <code class="docutils literal"><span class="pre">z</span> <span class="pre">=</span> <span class="pre">cos(r)</span> <span class="pre">/</span> <span class="pre">(r</span> <span class="pre">+</span> <span class="pre">5)</span></code> that you made previously.  Set
<code class="docutils literal"><span class="pre">z</span> <span class="pre">=</span> <span class="pre">0</span></code> for every pixel of <code class="docutils literal"><span class="pre">z</span></code> that is within 10 units of (x,y) = (10, 15).</p>
</div>
<p class="flip5">Click here to show/hide solution</p> <div class="panel5"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="mi">15</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="mi">10</span>
<span class="n">z</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="s1">&#39;lower&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/ripple_masked.png"><img alt="../_images/ripple_masked.png" src="../_images/ripple_masked.png" style="width: 406.0px; height: 306.0px;" /></a>
</div><div class="admonition-detour-copy-versus-reference admonition">
<p class="first admonition-title">Detour: copy versus reference</p>
<dl class="docutils">
<dt><strong>Question</strong></dt>
<dd>In the median filtering commands above we wrote <code class="docutils literal"><span class="pre">img_cr</span> <span class="pre">=</span> <span class="pre">img.copy()</span></code>.  Why
was that needed instead of just <code class="docutils literal"><span class="pre">img_cr</span> <span class="pre">=</span> <span class="pre">img</span></code>?</dd>
<dt><strong>Answer</strong></dt>
<dd>Because the statement <code class="docutils literal"><span class="pre">img_cr</span> <span class="pre">=</span> <span class="pre">img</span></code> would just create another reference
pointing to the underlying array object that <code class="docutils literal"><span class="pre">img</span></code> references. In other
words, all it would do is give you another name by which to access for
the same block of data.</dd>
</dl>
<p>Variable names in Python are just “pointers” to actual Python objects. To
see this clearly do the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># Unique identifier for the object referred to by &quot;a&quot;</span>
<span class="go">122333200</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># Unique identifier for the object referred to by &quot;b&quot;</span>
<span class="go">122333200</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>  <span class="c1"># Modifying &quot;b&quot; modifies &quot;a&quot; too!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([  0,   1,   2, -10,   4,   5,   6,   7])</span>
</pre></div>
</div>
<p>After getting over the initial confusion this behavior is actually a good
thing because it is efficient and consistent within Python.  If you really
need a copy of an array then use the copy() method as shown.</p>
<p><strong>BEWARE</strong> of one common pitfall: &#8220;basic&#8221; slicing in NumPy, like
<code class="docutils literal"><span class="pre">a[3:6]</span></code>, does <em>not</em> make copies:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">array([-10,   4,   5])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([  0,   1,   2, -10, 100,   5,   6,   7])</span>
</pre></div>
</div>
<p>However if you do arithmetic or boolean mask then a copy is always made:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([  0, 100,   2,   3])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>  <span class="c1"># Still as expected after changing &quot;a&quot;</span>
<span class="go">array([0, 1, 4, 9])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="fit-the-background">
<h2>Fit the background<a class="headerlink" href="#fit-the-background" title="Permalink to this headline">¶</a></h2>
<p>To subtract the background signal from the source region we want to fit a
quadratic to the background pixels, then subtract that quadratic from the
entire image — including the source region.</p>
<p>Let&#8217;s tackle a simpler problem first and fit the background for a single
column. From visual inspection of the 2D spectrum, we have decided to isolate
rows 10–199 and 300–479 as ones containing pure background signal:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">480</span><span class="p">))</span>  <span class="c1"># Background rows</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">img_cr</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>  <span class="c1"># Background rows in column 10 of cleaned image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">pfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Fit a 2nd order polynomial to (x, y) data</span>
<span class="n">yfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">pfit</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>  <span class="c1"># Evaluate the polynomial at x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yfit</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/bkg_fit0.png"><img alt="../_images/bkg_fit0.png" src="../_images/bkg_fit0.png" style="width: 406.0px; height: 306.0px;" /></a>
<p>Now let’s do this for every column and store the results in a background
image:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">xrows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">img_cr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>          <span class="c1"># Array from 0 .. N_rows-1</span>
<span class="n">bkg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">img_cr</span><span class="p">)</span>                 <span class="c1"># Empty image for background fits</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">img_cr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>      <span class="c1"># For each column ...</span>
    <span class="n">pfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">img_cr</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">col</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># Fit poly over bkg rows for col</span>
    <span class="n">bkg</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">pfit</span><span class="p">,</span> <span class="n">xrows</span><span class="p">)</span>   <span class="c1"># Eval poly at ALL row positions</span>

<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">bkg</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/bkg_fit1.png"><img alt="../_images/bkg_fit1.png" src="../_images/bkg_fit1.png" style="width: 406.0px; height: 306.0px;" /></a>
<p>Finally let’s subtract this background and see how the results look:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">img_bkg</span> <span class="o">=</span> <span class="n">img_cr</span> <span class="o">-</span> <span class="n">bkg</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_bkg</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Background subtracted</strong></th>
<th class="head"><strong>Original</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="first last reference internal image-reference" href="../_images/bkg_fit2.png"><img alt="../_images/bkg_fit2.png" src="../_images/bkg_fit2.png" style="width: 406.0px; height: 306.0px;" /></a>
</td>
<td><a class="first last reference internal image-reference" href="../_images/imgview_img.png"><img alt="../_images/imgview_img.png" src="../_images/imgview_img.png" style="width: 406.0px; height: 306.0px;" /></a>
</td>
</tr>
</tbody>
</table>
<div class="admonition-detour-vector-operations-versus-looping admonition">
<p class="first admonition-title">Detour: vector operations versus looping</p>
<p>If you are used to C or Fortran you might be wondering why jump through these
hoops with slicing and making sure everything is vectorized.  The answer is
that pure Python is an interpreted dynamic language and hence doing loops is
<em>slow</em>. Try the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>size = 500000
x = np.arange(size)
a = np.zeros(size)
%time for i in x: a[i] = x[i] / 2.0
</pre></div>
</div>
<p>Now compare to the vectorized NumPy solution:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>x = np.arange(size)
%time a = x / 2
</pre></div>
</div>
<p class="last">Sometimes doing things in a vectorized way is not possible or just too
confusing.  There is an art here and the basic answer is that if it runs
fast enough then you are good to go.  Otherwise things need to be vectorized
or maybe coded in C or Fortran.</p>
</div>
</div>
<div class="section" id="sum-the-source-signal">
<h2>Sum the source signal<a class="headerlink" href="#sum-the-source-signal" title="Permalink to this headline">¶</a></h2>
<p>The final step in our analysis is to sum up the remaining source signal across
rows to obtain a one-dimensional spectrum. We leave this as an exercise!</p>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Python for Astronomers Spectrum</strong></th>
<th class="head"><strong>HST official spectrum</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="first last reference internal image-reference" href="../_images/spectrum_final.png"><img alt="../_images/spectrum_final.png" src="../_images/spectrum_final.png" style="width: 406.0px; height: 306.0px;" /></a>
</td>
<td><a class="first last reference internal image-reference" href="../_images/3c120_spec.gif"><img alt="../_images/3c120_spec.gif" src="../_images/3c120_spec.gif" style="width: 382.5px; height: 306.0px;" /></a>
</td>
</tr>
</tbody>
</table>
<p>The biggest difference between our result and the official HST result is that
they have flux-calibrated the instrument’s response as a function of
wavelength. We haven’t bothered to do that here.</p>
<div class="admonition-exercise-make-the-final-spectrum admonition">
<p class="first admonition-title">Exercise: Make the final spectrum</p>
<p class="last">Take the background-subtracted spectrum, sum up the rows containing the
astronomical signal, and plot the resulting one-dimensional spectrum.
You’ve already done this step in a previous exercise, but it was just using
the un-corrected data.</p>
</div>
<p class="flip6">Click here to show/hide solution</p> <div class="panel6"><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">spectrum</span> <span class="o">=</span> <span class="n">img_bkg</span><span class="p">[</span><span class="mi">250</span><span class="p">:</span><span class="mi">260</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
<div class="section" id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>There is much more to do and learn! We have omitted many important details in
this crash course, and there are literally thousands of features in the
astronomical Python toolkit that we haven’t even mentioned. Just take a quick
look at the tables of contents for the <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/">SciPy Reference Manual</a> or the <a class="reference external" href="http://docs.astropy.org/en/stable/">AstroPy documentation</a> to get a sense of how much is
available.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">A Crash Course in Scientific Python: 2D STIS Reduction</a><ul>
<li><a class="reference internal" href="#setup">Setup</a></li>
<li><a class="reference internal" href="#warming-up-your-ipython-session">Warming up your IPython session</a></li>
<li><a class="reference internal" href="#read-in-the-two-dimensional-image">Read in the two-dimensional image</a><ul>
<li><a class="reference internal" href="#digging-deeper-in-the-2d-image">Digging deeper in the 2D image</a></li>
</ul>
</li>
<li><a class="reference internal" href="#numpy-basics">NumPy basics</a><ul>
<li><a class="reference internal" href="#making-arrays">Making arrays</a></li>
<li><a class="reference internal" href="#array-access-and-slicing">Array access and slicing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plot-the-spatial-profile-and-raw-spectrum">Plot the spatial profile and raw spectrum</a></li>
<li><a class="reference internal" href="#filter-cosmic-rays-from-the-background">Filter cosmic rays from the background</a></li>
<li><a class="reference internal" href="#fit-the-background">Fit the background</a></li>
<li><a class="reference internal" href="#sum-the-source-signal">Sum the source signal</a></li>
<li><a class="reference internal" href="#next-steps">Next steps</a></li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="ipython.html"
                        title="previous chapter">IPython</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../contest/bounce.html"
                        title="next chapter">CONTEST: Make a fun bouncing balls demo</a></p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../_sources/core/numpy_scipy.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011-2015, Smithsonian Astrophysical Observatory under
    terms of <a rel="license"
                href="http://creativecommons.org/licenses/by/3.0/">CC
      Attribution 3.0</a>.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1. &nbsp;
</footer>
  </body>
</html>